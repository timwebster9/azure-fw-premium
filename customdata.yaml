#cloud-config
package_upgrade: true
packages:
  - nginx
write_files:
- content: |
    <html>Welcome to fwpoctimw.uksouth.cloudapp.azure.com</html>
  path: /var/www/fwpoctimw.uksouth.cloudapp.azure.com/index.html
  owner: root:root

- path: /etc/nginx/sites-enabled/fwpoctimw.uksouth.cloudapp.azure.com
  content: |
    server {
        listen 80;
        listen [::]:80;

        server_name fwpoctimw.uksouth.cloudapp.azure.com;
        root /var/www/fwpoctimw.uksouth.cloudapp.azure.com;
        index index.html;

        location / {
          try_files $uri $uri/ =404;
        }
    }
runcmd:
  - nginx -t
  - systemctl restart nginx
  - snap install core; snap refresh core
  - snap install --classic certbot
  - ln -s /snap/bin/certbot /usr/bin/certbot
  - certbot --nginx -m tim.webster@contino.io -d fwpoctimw.uksouth.cloudapp.azure.com --agree-tos